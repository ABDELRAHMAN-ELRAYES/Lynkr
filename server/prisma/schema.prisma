generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// Module 1: Identity & Access Management (IAM)
// ============================================

model User {
  id                String    @id @default(uuid())
  firstName         String    @map("first_name")
  lastName          String    @map("last_name")
  username          String?   @unique
  email             String    @unique
  phone             String?   @unique
  password          String
  role              String    @default("CLIENT")
  active            Boolean   @default(true)
  emailVerified     Boolean   @default(false) @map("email_verified")
  passwordChangedAt DateTime? @map("password_changed_at")
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")

  // Relations
  // User -> AdminPrivilege (One -> Many)
  privileges                AdminPrivilege[]
  // User -> ProviderProfile (One -> One)
  providerProfile           ProviderProfile?
  // User -> Request (One -> Many)
  clientRequests            Request[]             @relation("ClientRequests")
  // User -> ProviderApplication (One -> Many)
  providerApplications      ProviderApplication[]
  // User -> ApplicationReview (One -> Many)
  adminReviews              ApplicationReview[]   @relation("AdminReviews")
  // User -> Project (One -> Many) - as client
  clientProjects            Project[]             @relation("ClientProjects")
  // User -> Payment (One -> Many) - as payer
  clientPayments            Payment[]             @relation("ClientPayments")
  // User -> ProjectFile (One -> Many) - as uploader
  projectFiles              ProjectFile[]
  // User -> ProjectActivity (One -> Many)
  projectActivities         ProjectActivity[]
  // User -> Conversation (One -> Many) - as participant1
  participant1Conversations Conversation[]        @relation("Participant1Conversations")
  // User -> Conversation (One -> Many) - as participant2
  participant2Conversations Conversation[]        @relation("Participant2Conversations")
  // User -> Message (One -> Many) - as sender
  sentMessages              Message[]             @relation("SentMessages")
  // User -> Meeting (One -> Many) - as host
  hostedMeetings            Meeting[]             @relation("MeetingHost")
  // User -> Meeting (One -> Many) - as guest
  guestMeetings             Meeting[]             @relation("MeetingGuest")
  // User -> Review (One -> Many) - reviews given
  reviewsGiven              Review[]              @relation("ReviewsGiven")
  // User -> Review (One -> Many) - reviews received
  reviewsReceived           Review[]              @relation("ReviewsReceived")
  // User -> Notification (One -> Many)
  notifications             Notification[]
  // User -> Report (One -> Many) - reports submitted
  reportsSubmitted          Report[]              @relation("ReportsSubmitted")
  // User -> Report (One -> Many) - reports received
  reportsReceived           Report[]              @relation("ReportsReceived")
  // User -> ReportAction (One -> Many) - admin actions taken
  adminActions              ReportAction[]        @relation("AdminActions")
  // User -> MeetingRequest (One -> Many)
  meetingRequests           MeetingRequest[]      @relation("MeetingRequests")

  @@map("users")
}

model AdminPrivilege {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  name      String
  createdAt DateTime @default(now()) @map("created_at")

  // Relations
  // AdminPrivilege -> User (Many -> One)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, name])
  @@map("admin_privileges")
}

// ============================================
// Module 2: Provider Profile & Onboarding
// ============================================

model ProviderProfile {
  id               String   @id @default(uuid())
  userId           String   @unique @map("user_id")
  serviceId        String?  @map("service_id") // Single service the provider specializes in
  title            String? // Professional title
  bio              String?  @db.Text
  hourlyRate       Decimal? @map("hourly_rate")
  availableBalance Decimal  @default(0) @map("available_balance")
  isApproved       Boolean  @default(false) @map("is_approved")
  averageRating    Decimal? @map("average_rating")
  totalReviews     Int      @default(0) @map("total_reviews")
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @updatedAt @map("updated_at")

  // Relations
  // ProviderProfile -> User (One -> One)
  user                 User                       @relation(fields: [userId], references: [id], onDelete: Cascade)
  // ProviderProfile -> Service (Many -> One)
  service              Service?                   @relation(fields: [serviceId], references: [id])
  // ProviderProfile -> ProviderSkill (One -> Many)
  skills               ProviderSkill[]
  // ProviderProfile -> ProviderExperience (One -> Many)
  experiences          ProviderExperience[]
  // ProviderProfile -> ProviderEducation (One -> Many)
  education            ProviderEducation[]
  // ProviderProfile -> ProviderLanguage (One -> Many)
  languages            ProviderLanguage[]
  // ProviderProfile -> Request (One -> Many)
  targetRequests       Request[]                  @relation("TargetProviderRequests")
  // ProviderProfile -> Proposal (One -> Many)
  proposals            Proposal[]
  // ProviderProfile -> ProviderApplication (One -> Many)
  providerApplications ProviderApplication[]
  // ProviderProfile -> Project (One -> Many)
  projects             Project[]
  // ProviderProfile -> ProviderAvailability (One -> Many)
  availabilities       ProviderAvailability[]
  // ProviderProfile -> ProviderSubscription (One -> Many)
  subscriptions        ProviderSubscription[]
  // ProviderProfile -> ProviderDocument (One -> Many)
  documents            ProviderDocument[]
  // ProviderProfile -> ProviderPortfolioProject (One -> Many)
  portfolioProjects    ProviderPortfolioProject[]

  @@map("provider_profiles")
}

// ============================================
// Service & Skill Master Tables
// ============================================

model Service {
  id          String   @id @default(uuid())
  name        String   @unique
  description String?
  type        String   @default("PROJECT") // HOURLY or PROJECT
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Relations
  // Service -> Skill (One -> Many)
  skills           Skill[]
  // Service -> ProviderProfile (One -> Many)
  providerProfiles ProviderProfile[]

  @@map("services")
}

model Skill {
  id        String   @id @default(uuid())
  name      String
  serviceId String   @map("service_id")
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")

  // Relations
  // Skill -> Service (Many -> One)
  service Service @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@map("skills")
}

model ProviderSkill {
  id                String @id @default(uuid())
  providerProfileId String @map("provider_profile_id")
  skillName         String @map("skill_name")

  // Relations
  // ProviderSkill -> ProviderProfile (Many -> One)
  providerProfile ProviderProfile @relation(fields: [providerProfileId], references: [id], onDelete: Cascade)

  @@map("provider_skills")
}

model ProviderExperience {
  id                String    @id @default(uuid())
  providerProfileId String    @map("provider_profile_id")
  title             String
  company           String
  location          String
  country           String
  description       String?   @db.Text
  startDate         DateTime  @map("start_date") @db.Date
  endDate           DateTime? @map("end_date") @db.Date

  // Relations
  // ProviderExperience -> ProviderProfile (Many -> One)
  providerProfile ProviderProfile @relation(fields: [providerProfileId], references: [id], onDelete: Cascade)

  @@map("provider_experiences")
}

model ProviderEducation {
  id                String    @id @default(uuid())
  providerProfileId String    @map("provider_profile_id")
  school            String
  degree            String
  fieldOfStudy      String    @map("field_of_study")
  description       String?   @db.Text
  startDate         DateTime  @map("start_date") @db.Date
  endDate           DateTime? @map("end_date") @db.Date

  // Relations
  // ProviderEducation -> ProviderProfile (Many -> One)
  providerProfile ProviderProfile @relation(fields: [providerProfileId], references: [id], onDelete: Cascade)

  @@map("provider_education")
}

model ProviderLanguage {
  id                String @id @default(uuid())
  providerProfileId String @map("provider_profile_id")
  language          String
  proficiency       String

  // Relations
  // ProviderLanguage -> ProviderProfile (Many -> One)
  providerProfile ProviderProfile @relation(fields: [providerProfileId], references: [id], onDelete: Cascade)

  @@map("provider_languages")
}

model ProviderDocument {
  id                String   @id @default(uuid())
  providerProfileId String   @map("provider_profile_id")
  title             String
  description       String?  @db.Text
  documentType      String   @map("document_type") // RESUME, CERTIFICATE, LICENSE, OTHER
  fileId            String   @map("file_id")
  isPublic          Boolean  @default(false) @map("is_public")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")

  // Relations
  // ProviderDocument -> ProviderProfile (Many -> One)
  providerProfile ProviderProfile @relation(fields: [providerProfileId], references: [id], onDelete: Cascade)
  // ProviderDocument -> File (Many -> One)
  file            File            @relation(fields: [fileId], references: [id])

  @@map("provider_documents")
}

model ProviderPortfolioProject {
  id                String   @id @default(uuid())
  providerProfileId String   @map("provider_profile_id")
  name              String
  description       String   @db.Text
  projectLink       String?  @map("project_link")
  isPublic          Boolean  @default(true) @map("is_public")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")

  // Relations
  // ProviderPortfolioProject -> ProviderProfile (Many -> One)
  providerProfile ProviderProfile                 @relation(fields: [providerProfileId], references: [id], onDelete: Cascade)
  // ProviderPortfolioProject -> ProviderPortfolioProjectImage (One -> Many)
  images          ProviderPortfolioProjectImage[]
  // ProviderPortfolioProject -> ProviderPortfolioProjectTag (One -> Many)
  tags            ProviderPortfolioProjectTag[]

  @@map("provider_portfolio_projects")
}

model ProviderPortfolioProjectImage {
  id        String   @id @default(uuid())
  projectId String   @map("project_id")
  fileId    String   @map("file_id")
  order     Int      @default(0) // For image ordering
  createdAt DateTime @default(now()) @map("created_at")

  // Relations
  // ProviderPortfolioProjectImage -> ProviderPortfolioProject (Many -> One)
  project ProviderPortfolioProject @relation(fields: [projectId], references: [id], onDelete: Cascade)
  // ProviderPortfolioProjectImage -> File (Many -> One)
  file    File                     @relation(fields: [fileId], references: [id])

  @@map("provider_portfolio_project_images")
}

model ProviderPortfolioProjectTag {
  id        String   @id @default(uuid())
  projectId String   @map("project_id")
  tag       String
  createdAt DateTime @default(now()) @map("created_at")

  // Relations
  // ProviderPortfolioProjectTag -> ProviderPortfolioProject (Many -> One)
  project ProviderPortfolioProject @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@map("provider_portfolio_project_tags")
}

model ProviderApplication {
  id                String    @id @default(uuid())
  userId            String    @map("user_id")
  providerProfileId String?   @map("provider_profile_id")
  status            String    @default("PENDING") // PENDING, APPROVED, REJECTED
  cooldownEndsAt    DateTime? @map("cooldown_ends_at")
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")

  // Relations
  // ProviderApplication -> User (Many -> One)
  user            User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  // ProviderApplication -> ProviderProfile (Many -> One)
  providerProfile ProviderProfile?   @relation(fields: [providerProfileId], references: [id])
  // ProviderApplication -> ApplicationReview (One -> One)
  review          ApplicationReview?

  @@map("provider_applications")
}

model ApplicationReview {
  id            String   @id @default(uuid())
  applicationId String   @unique @map("application_id")
  adminId       String   @map("admin_id")
  decision      String // APPROVED, REJECTED
  reason        String?  @db.Text
  reviewedAt    DateTime @default(now()) @map("reviewed_at")

  // Relations
  // ApplicationReview -> ProviderApplication (One -> One)
  application ProviderApplication @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  // ApplicationReview -> User (Many -> One)
  admin       User                @relation("AdminReviews", fields: [adminId], references: [id])

  @@map("application_reviews")
}

// ============================================
// Module 4: Requests & Proposals
// ============================================

model Request {
  id                String    @id @default(uuid())
  clientId          String    @map("client_id")
  targetProviderId  String?   @map("target_provider_id")
  title             String
  description       String    @db.Text
  category          String
  budgetType        String    @map("budget_type")
  budgetCurrency    String    @default("USD") @map("budget_currency")
  fromBudget        Decimal?  @map("from_budget")
  toBudget          Decimal?  @map("to_budget")
  deadline          DateTime?
  responseDeadline  DateTime  @map("response_deadline")
  status            String    @default("PENDING")
  isPublic          Boolean   @default(false) @map("is_public")
  enableAutoPublish Boolean   @default(false) @map("enable_auto_publish")
  ndaRequired       Boolean   @default(false) @map("nda_required")
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")

  // Relations
  // Request -> ProviderProfile (Many -> One)
  targetProvider ProviderProfile? @relation("TargetProviderRequests", fields: [targetProviderId], references: [id])
  // Request -> Proposal (One -> Many)
  proposals      Proposal[]
  // Request -> RequestFile (One -> Many)
  attachments    RequestFile[]
  // Request -> User (Many -> One)
  client         User             @relation("ClientRequests", fields: [clientId], references: [id], onDelete: Cascade)

  @@map("requests")
}

model Proposal {
  id                String   @id @default(uuid())
  requestId         String   @map("request_id")
  providerProfileId String   @map("provider_profile_id")
  price             Decimal
  priceType         String   @map("price_type")
  estimatedDays     Int      @map("estimated_days")
  notes             String?  @db.Text
  status            String   @default("PENDING")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")

  // Relations
  // Proposal -> Request (Many -> One)
  request         Request         @relation(fields: [requestId], references: [id], onDelete: Cascade)
  // Proposal -> ProviderProfile (Many -> One)
  providerProfile ProviderProfile @relation(fields: [providerProfileId], references: [id])
  // Proposal -> ProposalFile (One -> Many)
  attachments     ProposalFile[]
  // Proposal -> Project (One -> One)
  project         Project?

  @@unique([requestId, providerProfileId])
  @@map("proposals")
}

// ============================================
// Module 12: File Management
// ============================================

model File {
  id        String   @id @default(uuid())
  filename  String
  path      String
  mimetype  String
  size      Int
  createdAt DateTime @default(now()) @map("created_at")

  // Relations
  // File -> RequestFile (One -> Many)
  requestFiles  RequestFile[]
  // File -> ProposalFile (One -> Many)
  proposalFiles ProposalFile[]
  // File -> ProjectFile (One -> Many)
  projectFiles  ProjectFile[]

  // File -> ReportFile (One -> Many)
  reportFiles                    ReportFile[]
  // File -> ProviderDocument (One -> Many)
  providerDocuments              ProviderDocument[]
  // File -> ProviderPortfolioProjectImage (One -> Many)
  providerPortfolioProjectImages ProviderPortfolioProjectImage[]

  @@map("files")
}

// Request <-> File (Many -> Many)
model RequestFile {
  id        String   @id @default(uuid())
  requestId String   @map("request_id")
  fileId    String   @map("file_id")
  createdAt DateTime @default(now()) @map("created_at")

  // Relations
  // RequestFile -> Request (Many -> One)
  request Request @relation(fields: [requestId], references: [id], onDelete: Cascade)
  // RequestFile -> File (Many -> One)
  file    File    @relation(fields: [fileId], references: [id], onDelete: Cascade)

  @@map("request_files")
}

// Proposal <-> File (Many -> Many)
model ProposalFile {
  id         String   @id @default(uuid())
  proposalId String   @map("proposal_id")
  fileId     String   @map("file_id")
  createdAt  DateTime @default(now()) @map("created_at")

  // Relations
  // ProposalFile -> Proposal (Many -> One)
  proposal Proposal @relation(fields: [proposalId], references: [id], onDelete: Cascade)
  // ProposalFile -> File (Many -> One)
  file     File     @relation(fields: [fileId], references: [id], onDelete: Cascade)

  @@map("proposal_files")
}

// ============================================
// Module 5: Payments & Escrow
// ============================================

model Payment {
  id              String    @id @default(uuid())
  payerId         String    @map("payer_id")
  amount          Decimal
  currency        String    @default("USD")
  paymentType     String    @map("payment_type") // FULL, INITIAL, FINAL, SESSION
  status          String    @default("PENDING") // PENDING, COMPLETED, REFUNDED, CANCELLED
  stripePaymentId String?   @map("stripe_payment_id")
  paidAt          DateTime? @map("paid_at")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  // Relations
  // Payment -> User (Many -> One)
  payer          User            @relation("ClientPayments", fields: [payerId], references: [id])
  // Payment -> ProjectPayment (One -> One)
  projectPayment ProjectPayment?

  @@map("payments")
}

// Payment <-> Project
model ProjectPayment {
  id        String @id @default(uuid())
  paymentId String @unique @map("payment_id")
  projectId String @map("project_id")

  // Relations
  // ProjectPayment -> Payment (One -> One)
  payment Payment @relation(fields: [paymentId], references: [id], onDelete: Cascade)
  // ProjectPayment -> Project (Many -> One)
  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@map("project_payments")
}

model Escrow {
  id            String    @id @default(uuid())
  projectId     String    @unique @map("project_id")
  depositAmount Decimal   @map("deposit_amount")
  balance       Decimal   @default(0)
  status        String    @default("HOLDING") // HOLDING, RELEASED, REFUNDED
  releasedAt    DateTime? @map("released_at")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  // Relations
  // Escrow -> Project (One -> One)
  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@map("escrows")
}

// ============================================
// Module 6: Project Workspace & Collaboration
// ============================================

model Project {
  id                 String    @id @default(uuid())
  clientId           String    @map("client_id")
  providerProfileId  String    @map("provider_profile_id")
  acceptedProposalId String    @unique @map("accepted_proposal_id")
  status             String    @default("PENDING_PAYMENT") // PENDING_PAYMENT, IN_PROGRESS, COMPLETED, CANCELLED
  totalPrice         Decimal   @map("total_price")
  paidAmount         Decimal   @default(0) @map("paid_amount")
  startedAt          DateTime? @map("started_at")
  completedAt        DateTime? @map("completed_at")
  createdAt          DateTime  @default(now()) @map("created_at")
  updatedAt          DateTime  @updatedAt @map("updated_at")

  // Relations
  // Project -> User (Many -> One)
  client           User              @relation("ClientProjects", fields: [clientId], references: [id])
  // Project -> ProviderProfile (Many -> One)
  providerProfile  ProviderProfile   @relation(fields: [providerProfileId], references: [id])
  // Project -> Proposal (One -> One)
  acceptedProposal Proposal          @relation(fields: [acceptedProposalId], references: [id])
  // Project -> Escrow (One -> One)
  escrow           Escrow?
  // Project -> ProjectPayment (One -> Many)
  projectPayments  ProjectPayment[]
  // Project -> ProjectFile (One -> Many)
  files            ProjectFile[]
  // Project -> ProjectActivity (One -> Many)
  activities       ProjectActivity[]
  // Project -> Conversation (One -> One)
  conversation     Conversation?
  // Project -> Meeting (One -> Many)
  meetings         Meeting[]
  // Project -> ProjectReview (One -> Many)
  reviews          ProjectReview[]
  // Project -> MeetingRequest (One -> Many)
  meetingRequests  MeetingRequest[]

  @@map("projects")
}

// Project <-> File (Many -> Many)
model ProjectFile {
  id          String   @id @default(uuid())
  projectId   String   @map("project_id")
  fileId      String   @map("file_id")
  uploaderId  String   @map("uploader_id")
  description String?
  createdAt   DateTime @default(now()) @map("created_at")

  // Relations
  // ProjectFile -> Project (Many -> One)
  project  Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  // ProjectFile -> File (Many -> One)
  file     File    @relation(fields: [fileId], references: [id], onDelete: Cascade)
  // ProjectFile -> User (Many -> One)
  uploader User    @relation(fields: [uploaderId], references: [id])

  @@map("project_files")
}

model ProjectActivity {
  id        String   @id @default(uuid())
  projectId String   @map("project_id")
  userId    String   @map("user_id")
  action    String // FILE_UPLOADED, STATUS_CHANGED, COMPLETION_REQUESTED, COMPLETION_CONFIRMED, PROJECT_CANCELLED
  details   String?  @db.Text
  createdAt DateTime @default(now()) @map("created_at")

  // Relations
  // ProjectActivity -> Project (Many -> One)
  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  // ProjectActivity -> User (Many -> One)
  user    User    @relation(fields: [userId], references: [id])

  @@map("project_activities")
}

// ============================================
// Module 7: Messaging System
// ============================================

model Conversation {
  id             String   @id @default(uuid())
  projectId      String   @unique @map("project_id")
  participant1Id String   @map("participant_1_id")
  participant2Id String   @map("participant_2_id")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  // Relations
  // Conversation -> Project (One -> One)
  project      Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
  // Conversation -> User (Many -> One) - participant1
  participant1 User      @relation("Participant1Conversations", fields: [participant1Id], references: [id])
  // Conversation -> User (Many -> One) - participant2
  participant2 User      @relation("Participant2Conversations", fields: [participant2Id], references: [id])
  // Conversation -> Message (One -> Many)
  messages     Message[]

  @@map("conversations")
}

model Message {
  id             String   @id @default(uuid())
  conversationId String   @map("conversation_id")
  senderId       String   @map("sender_id")
  content        String   @db.Text
  isRead         Boolean  @default(false) @map("is_read")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  // Relations
  // Message -> Conversation (Many -> One)
  conversation Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  // Message -> User (Many -> One) - sender
  sender       User         @relation("SentMessages", fields: [senderId], references: [id])

  @@map("messages")
}

// ============================================
// Module 6B: Video Meetings (Agora)
// ============================================

model Meeting {
  id          String    @id @default(uuid())
  projectId   String    @map("project_id")
  hostId      String    @map("host_id")
  guestId     String    @map("guest_id")
  channelName String    @unique @map("channel_name")
  status      String    @default("PENDING") // PENDING, ACTIVE, COMPLETED, CANCELLED
  scheduledAt DateTime? @map("scheduled_at")
  startedAt   DateTime? @map("started_at")
  endedAt     DateTime? @map("ended_at")
  duration    Int? // In seconds
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  // Relations
  // Meeting -> Project (Many -> One)
  project        Project         @relation(fields: [projectId], references: [id], onDelete: Cascade)
  // Meeting -> User (Many -> One) - host
  host           User            @relation("MeetingHost", fields: [hostId], references: [id])
  // Meeting -> User (Many -> One) - guest
  guest          User            @relation("MeetingGuest", fields: [guestId], references: [id])
  // Meeting -> MeetingRequest (One -> One) - the request that created this meeting
  meetingRequest MeetingRequest?

  @@map("meetings")
}

// ============================================
// Module 7: Provider Availability & Meeting Scheduling
// ============================================

model ProviderAvailability {
  id                String   @id @default(uuid())
  providerProfileId String   @map("provider_profile_id")
  dayOfWeek         Int      @map("day_of_week")
  startTime         String   @map("start_time") // HH:mm format
  endTime           String   @map("end_time") // HH:mm format
  timezone          String   @default("UTC")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")

  // Relations
  // ProviderAvailability -> ProviderProfile (Many -> One)
  providerProfile ProviderProfile @relation(fields: [providerProfileId], references: [id], onDelete: Cascade)

  @@map("provider_availabilities")
}

model MeetingRequest {
  id              String    @id @default(uuid())
  projectId       String    @map("project_id")
  requestedById   String    @map("requested_by_id")
  proposedDate    DateTime  @map("proposed_date") @db.Date
  proposedTime    String    @map("proposed_time") // HH:mm format
  timezone        String    @default("UTC")
  isCustomTime    Boolean   @default(false) @map("is_custom_time")
  status          String    @default("PENDING") // PENDING, APPROVED, REJECTED, CANCELLED
  rejectionReason String?   @map("rejection_reason") @db.Text
  approvedAt      DateTime? @map("approved_at")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  // Relations
  // MeetingRequest -> Project (Many -> One)
  project     Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  // MeetingRequest -> User (Many -> One)
  requestedBy User     @relation("MeetingRequests", fields: [requestedById], references: [id])
  // MeetingRequest -> Meeting (One -> One) - created after approval
  meetingId   String?  @unique @map("meeting_id")
  meeting     Meeting? @relation(fields: [meetingId], references: [id])

  @@map("meeting_requests")
}

// ============================================
// Module 8: Ratings & Reviews
// ============================================

// Base review model containing common fields
model Review {
  id           String   @id @default(uuid())
  reviewerId   String   @map("reviewer_id")
  targetUserId String   @map("target_user_id")
  rating       Int // 1-5 stars
  comment      String?  @db.Text
  reviewType   String   @map("review_type") // CLIENT_TO_PROVIDER, PROVIDER_TO_CLIENT
  status       String   @default("SUBMITTED") // SUBMITTED, EXPIRED
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  // Relations
  // Review -> User (Many -> One) - reviewer
  reviewer      User           @relation("ReviewsGiven", fields: [reviewerId], references: [id])
  // Review -> User (Many -> One) - target
  targetUser    User           @relation("ReviewsReceived", fields: [targetUserId], references: [id])
  // Review -> ProjectReview (One -> One)
  projectReview ProjectReview?

  @@map("reviews")
}

// Review <-> Project
model ProjectReview {
  id        String @id @default(uuid())
  reviewId  String @unique @map("review_id")
  projectId String @map("project_id")

  // Relations
  // ProjectReview -> Review (One -> One)
  review  Review  @relation(fields: [reviewId], references: [id], onDelete: Cascade)
  // ProjectReview -> Project (Many -> One)
  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([reviewId, projectId])
  @@map("project_reviews")
}

// ============================================
// Module 9: Notifications & Activity Feed
// ============================================

model Notification {
  id         String   @id @default(uuid())
  userId     String   @map("user_id")
  title      String
  message    String   @db.Text
  type       String // MESSAGE, PROPOSAL, PROJECT, PAYMENT, REVIEW, SESSION, SYSTEM
  category   String // COMMUNICATION, REQUESTS_PROPOSALS, PAYMENTS, PROJECT_SESSION, REVIEWS, SYSTEM
  entityId   String?  @map("entity_id")
  entityType String?  @map("entity_type")
  isRead     Boolean  @default(false) @map("is_read")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  // Relations
  // Notification -> User (Many -> One)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, isRead])
  @@map("notifications")
}

// ============================================
// Module 10: Reporting & Moderation
// ============================================

model Report {
  id           String   @id @default(uuid())
  reporterId   String   @map("reporter_id")
  targetUserId String?  @map("target_user_id")
  targetType   String   @map("target_type") // USER, PROJECT, SESSION, REQUEST
  targetId     String   @map("target_id")
  category     String // FRAUD, ABUSE, SERVICE_FAILURE, POLICY_VIOLATION, TECHNICAL
  description  String   @db.Text
  status       String   @default("SUBMITTED") // SUBMITTED, UNDER_REVIEW, RESOLVED, DISMISSED
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  // Relations
  // Report -> User (Many -> One) - reporter
  reporter   User           @relation("ReportsSubmitted", fields: [reporterId], references: [id])
  // Report -> User (Many -> One) - target user
  targetUser User?          @relation("ReportsReceived", fields: [targetUserId], references: [id])
  // Report -> ReportFile (One -> Many)
  files      ReportFile[]
  // Report -> ReportAction (One -> Many)
  actions    ReportAction[]

  @@map("reports")
}

// Report <-> File
model ReportFile {
  id        String   @id @default(uuid())
  reportId  String   @map("report_id")
  fileId    String   @map("file_id")
  createdAt DateTime @default(now()) @map("created_at")

  // Relations
  // ReportFile -> Report (Many -> One)
  report Report @relation(fields: [reportId], references: [id], onDelete: Cascade)
  // ReportFile -> File (Many -> One)
  file   File   @relation(fields: [fileId], references: [id], onDelete: Cascade)

  @@map("report_files")
}

model ReportAction {
  id         String   @id @default(uuid())
  reportId   String   @map("report_id")
  adminId    String   @map("admin_id")
  actionType String   @map("action_type") // STATUS_CHANGE, WARNING, SUSPEND, BAN
  details    String?  @db.Text
  createdAt  DateTime @default(now()) @map("created_at")

  // Relations
  // ReportAction -> Report (Many -> One)
  report Report @relation(fields: [reportId], references: [id], onDelete: Cascade)
  // ReportAction -> User (Many -> One) - admin
  admin  User   @relation("AdminActions", fields: [adminId], references: [id])

  @@map("report_actions")
}

// ============================================
// Module 11: Subscription Plans
// ============================================

model SubscriptionPlan {
  id              String   @id @default(uuid())
  name            String
  description     String?  @db.Text
  price           Decimal  @db.Decimal(10, 2)
  durationDays    Int      @map("duration_days")
  visibilityBoost Int      @default(1) @map("visibility_boost") // 1=normal, 2=high, 3=featured
  isActive        Boolean  @default(true) @map("is_active")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  // Relations
  // SubscriptionPlan -> ProviderSubscription (One -> Many)
  subscriptions ProviderSubscription[]

  @@map("subscription_plans")
}

model ProviderSubscription {
  id                String    @id @default(uuid())
  providerProfileId String    @map("provider_profile_id")
  planId            String    @map("plan_id")
  status            String    @default("PENDING") // PENDING, ACTIVE, EXPIRED, CANCELLED
  paymentStatus     String    @default("PENDING") @map("payment_status") // PENDING, PAID, FAILED
  startDate         DateTime? @map("start_date")
  endDate           DateTime? @map("end_date")
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")

  // Relations
  // ProviderSubscription -> ProviderProfile (Many -> One)
  providerProfile ProviderProfile  @relation(fields: [providerProfileId], references: [id])
  // ProviderSubscription -> SubscriptionPlan (Many -> One)
  plan            SubscriptionPlan @relation(fields: [planId], references: [id])

  @@map("provider_subscriptions")
}

// ============================================
// Platform Settings
// ============================================

model Setting {
  id                 String   @id @default(uuid())
  platformName       String   @default("Lynkr") @map("platform_name")
  platformCommission Decimal  @default(15) @map("platform_commission") @db.Decimal(5, 2) // Percentage (0-100)
  minWithdrawal      Decimal  @default(10) @map("min_withdrawal") @db.Decimal(10, 2) // USD
  createdAt          DateTime @default(now()) @map("created_at")
  updatedAt          DateTime @updatedAt @map("updated_at")

  @@map("settings")
}
